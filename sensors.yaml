  - platform: template
    sensors:
      latest_lightning_strike_entity_id:
        friendly_name: "Latest Lightning Strike Entity ID"
        value_template: >
          {% set strikes = states.geo_location | selectattr('entity_id', 'search', 'geo_location.lightning_strike_') | sort(attribute='last_updated', reverse=true) | list %}
          {{ strikes[0].entity_id if strikes else 'none' }}

  # Get real location names from coordinates
  - platform: rest
    name: Latest Lightning Strike Area
    resource_template: >-
      https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat={{ state_attr(states('sensor.latest_lightning_strike_entity_id'), 'latitude') }}&lon={{ state_attr(states('sensor.latest_lightning_strike_entity_id'), 'longitude') }}
    headers:
      User-Agent: HomeAssistant/1.0
    value_template: >
      {{ value_json.address.suburb
         or value_json.address.city
         or value_json.address.town
         or value_json.address.village
         or value_json.address.state
         or value_json.display_name }}
    scan_interval: 3600
